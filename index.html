<!DOCTYPE html>
<html>
<head>
    <title>The Bitcoin Trail - Times Square Edition</title>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 0;
        }

        #game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        #game-window {
            border: 2px solid #fff;
            height: 400px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            background-color: #1a1a1a;
        }

        #stats-bar {
            border: 2px solid #fff;
            padding: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            background-color: #000;
        }

        #text-window {
            border: 2px solid #fff;
            padding: 10px;
            margin-bottom: 20px;
            min-height: 100px;
            background-color: #000;
        }

        button {
            background-color: #000;
            color: #fff;
            border: 2px solid #fff;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            width: 200px;
        }

        button:hover {
            background-color: #fff;
            color: #000;
        }

        .visible-text {
            opacity: 1;
            transition: opacity 0.5s;
        }

        .truth-text {
            opacity: 0;
            transition: opacity 0.5s;
        }

        @keyframes neonFlicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        @keyframes truthFlash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .neon-text {
            animation: neonFlicker 2s infinite;
        }

        .truth-flash {
            animation: truthFlash 3s infinite;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="title-screen" class="screen active">
            <h1 style="text-align: center;">The Bitcoin Trail</h1>
            <h2 style="text-align: center;">Times Square Edition</h2>
            <div style="text-align: center;">
                <p>Choose your hardware wallet:</p>
                <button onclick="startGame('Bitkey')">Bitkey</button><br>
                <button onclick="startGame('Trezor')">Trezor</button><br>
                <button onclick="startGame('Ledger')">Ledger</button><br>
                <button onclick="startGame('Foundation')">Foundation</button>
            </div>
        </div>

        <div id="game-screen" class="screen">
            <div id="game-window">
                <svg id="game-svg" width="100%" height="100%" style="background: linear-gradient(#1a1a3a, #4a4a6a);">
                    <!-- Filters -->
                    <defs>
                        <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                            <feGaussianBlur stdDeviation="5" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    
                    <!-- Background Buildings -->
                    <g id="background-buildings"></g>
                    
                    <!-- Street & Sidewalk -->
                    <rect x="0" y="320" width="100%" height="80" fill="#555"/> <!-- Wide Sidewalk -->
                    
                    <!-- Main Character -->
                    <g id="character" transform="translate(300, 290)">
                        <!-- Body -->
                        <rect width="20" height="40" fill="#fff"/>
                        <!-- Head -->
                        <circle cx="10" cy="0" r="8" fill="#fff"/>
                        <!-- Sunglasses (initially hidden) -->
                        <g id="sunglasses" style="display: none;">
                            <rect x="4" y="-2" width="12" height="4" fill="#000"/>
                            <rect x="2" y="-2" width="4" height="2" fill="#000"/>
                            <rect x="14" y="-2" width="4" height="2" fill="#000"/>
                        </g>
                        <!-- Legs -->
                        <g id="legs">
                            <rect id="leg1" width="6" height="20" x="4" y="40" fill="#fff"/>
                            <rect id="leg2" width="6" height="20" x="12" y="40" fill="#fff"/>
                        </g>
                        <!-- Wallet -->
                        <rect id="wallet" x="15" y="15" width="10" height="10" fill="#0f0"/>
                    </g>
                </svg>
            </div>
            
            <div id="stats-bar">
                <span>Wallet: <span id="wallet-type"></span></span>
                <span>Bitcoin: <span id="btc-amount">1.0 BTC</span></span>
                <span>Blocks: <span id="blocks">0</span></span>
            </div>
            
            <div id="text-window"></div>
            <div id="choices"></div>
        </div>
    </div>

    <script>
        // Get DOM elements
        const svg = document.getElementById('game-svg');
        const buildingsGroup = document.getElementById('background-buildings');
        const character = document.getElementById('character');
        const wallet = document.getElementById('wallet');
        const legs = document.getElementById('legs');
        const leg1 = document.getElementById('leg1');
        const leg2 = document.getElementById('leg2');

        // Game state
        let gameState = {
            wallet: null,
            btc: 1.0,
            blocks: 0,
            moving: true,
            time: 0,
            buildings: [],
            billboards: [],
            walkCycle: 0,
            characterX: 300,
            characterSpeed: 0.5,
            wearingSunglasses: false
        };

        // Billboard content
        const billboardContent = [
            {
                visible: { text: "WELLS CRYPTO", color: "#0ff" },
                truth: { text: "OBEY THE KING", color: "#f00" }
            },
            {
                visible: { text: "CRYPTO EXCHANGE", color: "#ff0" },
                truth: { text: "NOT YOUR KEYS", color: "#f00" }
            },
            {
                visible: { text: "DIGITAL DOLLAR", color: "#0f0" },
                truth: { text: "TOTAL SURVEILLANCE", color: "#f00" }
            },
            {
                visible: { text: "WESTERN UNION", color: "#ff0" },
                truth: { text: "PAY THE MOB", color: "#f00" }
            }
        ];

        // Create background buildings with billboards
        function createBackgroundBuildings() {
            buildingsGroup.innerHTML = '';
            gameState.buildings = [];
            gameState.billboards = [];
            
            // Create buildings with different heights
            for (let i = 0; i < 8; i++) {  // More buildings
                const buildingGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
                const height = 225 + Math.random() * 75; // Buildings between 225-300px tall (increased by 25%)
                const width = 112; // Width increased by 25% (from 90)
                const spacing = 38; // Spacing increased proportionally
                const x = i * (width + spacing); // Position with spacing
                
                // Main building shape
                const building = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                building.setAttribute('x', 0);  // Position relative to group
                building.setAttribute('y', 320 - height);
                building.setAttribute('width', width);
                building.setAttribute('height', height);
                building.setAttribute('fill', '#222');
                building.setAttribute('stroke', '#333');
                building.setAttribute('stroke-width', '1');
                buildingGroup.appendChild(building);

                // Add windows
                const windowRows = Math.floor(height / 25); // Increased window spacing
                const windowCols = 3;
                for (let row = 0; row < windowRows; row++) {
                    for (let col = 0; col < windowCols; col++) {
                        const windowLight = Math.random() > 0.3 ? '#ffff99' : '#666';
                        const windowEl = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                        windowEl.setAttribute('x', 19 + (col * 25));  // Increased spacing
                        windowEl.setAttribute('y', (320 - height + 19) + (row * 25));  // Increased spacing
                        windowEl.setAttribute('width', 15);  // Increased window size
                        windowEl.setAttribute('height', 15);  // Increased window size
                        windowEl.setAttribute('fill', windowLight);
                        buildingGroup.appendChild(windowEl);
                    }
                }

                // Add billboard if this is every 3rd building
                if (i % 3 === 1 && billboardContent[Math.floor(i/3)]) {  // Use i/3 to cycle through billboard content
                    const content = billboardContent[Math.floor(i/3)];
                    const billboardWidth = width * 0.85;
                    const billboardHeight = 31;  // Increased by 25% (from 25)
                    const billboardX = (width - billboardWidth) / 2;  // Center on building
                    const billboardY = 320 - height + 6;  // Slight adjustment for new height

                    // Billboard background
                    const board = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                    board.setAttribute('x', billboardX);
                    board.setAttribute('y', billboardY);
                    board.setAttribute('width', billboardWidth);
                    board.setAttribute('height', billboardHeight);
                    board.setAttribute('fill', '#000');
                    board.setAttribute('stroke', content.visible.color);
                    board.setAttribute('stroke-width', '0.5');
                    buildingGroup.appendChild(board);

                    // Add glow effect
                    const glow = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                    glow.setAttribute('x', billboardX);
                    glow.setAttribute('y', billboardY);
                    glow.setAttribute('width', billboardWidth);
                    glow.setAttribute('height', billboardHeight);
                    glow.setAttribute('fill', 'none');
                    glow.setAttribute('stroke', content.visible.color);
                    glow.setAttribute('stroke-width', '0.25');
                    glow.setAttribute('filter', 'url(#glow)');
                    buildingGroup.appendChild(glow);

                    // Visible text
                    const visibleText = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    visibleText.setAttribute('x', billboardX + (billboardWidth / 2));
                    visibleText.setAttribute('y', billboardY + 12);  // Adjusted for new height
                    visibleText.setAttribute('text-anchor', 'middle');
                    visibleText.setAttribute('fill', content.visible.color);
                    visibleText.setAttribute('font-size', '9');  // Increased by ~25%
                    visibleText.setAttribute('font-weight', 'bold');
                    visibleText.setAttribute('class', 'neon-text visible-text');
                    visibleText.textContent = content.visible.text;
                    buildingGroup.appendChild(visibleText);

                    // Truth text
                    const truthText = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    truthText.setAttribute('x', billboardX + (billboardWidth / 2));
                    truthText.setAttribute('y', billboardY + 25);  // Adjusted for new height
                    truthText.setAttribute('text-anchor', 'middle');
                    truthText.setAttribute('fill', content.truth.color);
                    truthText.setAttribute('font-size', '9');  // Increased by ~25%
                    truthText.setAttribute('font-weight', 'bold');
                    truthText.setAttribute('class', 'truth-text');
                    truthText.textContent = content.truth.text;
                    buildingGroup.appendChild(truthText);

                    // Store references to the texts for sunglasses effect
                    gameState.billboards.push({
                        visibleText: visibleText,
                        truthText: truthText,
                        board: board
                    });
                }

                buildingGroup.setAttribute('transform', `translate(${x}, 0)`);
                buildingsGroup.appendChild(buildingGroup);
                gameState.buildings.push({
                    element: buildingGroup,
                    x: x,
                    width: width,
                    height: height
                });
            }
        }

        // Animation loop
        function animate() {
            if (gameState.moving) {
                const buildingWidth = 112;  // Match the new building width
                const buildingSpacing = 38;  // Match the new spacing
                const totalWidth = gameState.buildings.length * (buildingWidth + buildingSpacing);
                
                // Move buildings (billboards will move with them)
                gameState.buildings.forEach((building) => {
                    building.x -= 0.5;
                    if (building.x < -buildingWidth) {
                        building.x += totalWidth;
                    }
                    building.element.setAttribute('transform', `translate(${building.x}, 0)`);
                });
                
                // Update sunglasses effect
                if (gameState.wearingSunglasses) {
                    gameState.billboards.forEach(billboard => {
                        billboard.visibleText.style.opacity = '0';
                        billboard.truthText.style.opacity = '1';
                        billboard.truthText.classList.add('truth-flash');
                        billboard.board.setAttribute('stroke', '#f00');
                    });
                } else {
                    gameState.billboards.forEach(billboard => {
                        billboard.visibleText.style.opacity = '1';
                        billboard.truthText.style.opacity = '0';
                        billboard.truthText.classList.remove('truth-flash');
                        billboard.board.setAttribute('stroke', billboard.visibleText.getAttribute('fill'));
                    });
                }

                // Animate character
                gameState.walkCycle += 0.05;
                const legOffset = Math.sin(gameState.walkCycle) * 5;
                leg1.setAttribute('y', 40 + legOffset);
                leg2.setAttribute('y', 40 - legOffset);

                // Update game stats
                gameState.time += 1/60;
                if (gameState.time >= 1) {
                    gameState.blocks++;
                    document.getElementById('blocks').textContent = gameState.blocks;
                    gameState.time = 0;
                }
            }
            
            requestAnimationFrame(animate);
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function startGame(walletType) {
            gameState.wallet = walletType;
            document.getElementById('wallet-type').textContent = walletType;
            wallet.setAttribute('fill', walletType === 'Bitkey' ? '#0f0' : '#f00');
            showScreen('game-screen');
            createBackgroundBuildings();
            animate();
            
            const textWindow = document.getElementById('text-window');
            const choices = document.getElementById('choices');
            
            textWindow.innerHTML = `
                <h3>Strange Discovery</h3>
                <p>As you begin your journey through Times Square, you notice something glinting in the crowd. 
                   A pair of mysterious sunglasses lies on the ground, seemingly untouched by the rushing feet around it.</p>
            `;
            
            choices.innerHTML = '';
            const yesButton = document.createElement('button');
            yesButton.textContent = 'Put on the sunglasses';
            yesButton.onclick = () => {
                gameState.wearingSunglasses = true;
                document.getElementById('sunglasses').style.display = 'block';
                textWindow.innerHTML += `
                    <p>You put on the sunglasses. Suddenly, the bright advertisements of Times Square 
                    take on a different meaning. You can see through the illusion...</p>
                `;
                choices.innerHTML = '';
                const continueButton = document.createElement('button');
                continueButton.textContent = 'Continue Journey';
                continueButton.onclick = () => {
                    gameState.moving = true;
                    setTimeout(generateEvent, 5000);
                };
                choices.appendChild(continueButton);
            };
            
            const noButton = document.createElement('button');
            noButton.textContent = 'Leave them alone';
            noButton.onclick = () => {
                gameState.wearingSunglasses = false;
                document.getElementById('sunglasses').style.display = 'none';
                textWindow.innerHTML += `
                    <p>You decide to leave the sunglasses where they are. Times Square continues to shine 
                    with its usual glamorous advertisements...</p>
                `;
                choices.innerHTML = '';
                const continueButton = document.createElement('button');
                continueButton.textContent = 'Continue Journey';
                continueButton.onclick = () => {
                    gameState.moving = true;
                    setTimeout(generateEvent, 5000);
                };
                choices.appendChild(continueButton);
            };
            
            choices.appendChild(yesButton);
            choices.appendChild(noButton);
            gameState.moving = false;
        }

        function generateEvent() {
            gameState.moving = false;
            const event = events[Math.floor(Math.random() * events.length)];
            const textWindow = document.getElementById('text-window');
            const choices = document.getElementById('choices');
            
            textWindow.innerHTML = `<h3>${event.title}</h3><p>${event.description}</p>`;
            choices.innerHTML = '';

            const options = gameState.wallet === 'Bitkey' ? event.bitkeyOptions : event.otherOptions;
            
            options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option.text;
                button.onclick = () => handleChoice(option.outcome);
                choices.appendChild(button);
            });
        }

        function handleChoice(outcome) {
            const textWindow = document.getElementById('text-window');
            const choices = document.getElementById('choices');
            
            textWindow.innerHTML += `<p>${outcome}</p>`;
            choices.innerHTML = '';

            const continueButton = document.createElement('button');
            continueButton.textContent = 'Continue Journey';
            continueButton.onclick = () => {
                gameState.moving = true;
                setTimeout(generateEvent, 5000 + Math.random() * 5000);
            };
            choices.appendChild(continueButton);
        }

        const events = [
            {
                title: "Times Square Chaos!",
                description: "You dropped your wallet in the crowded Times Square!",
                bitkeyOptions: [
                    {
                        text: "Use Self-Custody Recovery",
                        outcome: "You quickly recover access to your bitcoin right there in Times Square."
                    },
                    {
                        text: "Use Social Recovery",
                        outcome: "Your trusted contacts help you recover access while you enjoy the city lights."
                    }
                ],
                otherOptions: [
                    {
                        text: "Check seed phrase backup",
                        outcome: "You rush home through the crowds to check your seed phrase..."
                    }
                ]
            },
            {
                title: "Tourist Collision!",
                description: "A tourist taking photos bumped into you and your wallet fell!",
                bitkeyOptions: [
                    {
                        text: "Use Self-Custody Recovery",
                        outcome: "No problem! You recover your bitcoin using your phone while helping the tourist with directions."
                    },
                    {
                        text: "Use Social Recovery",
                        outcome: "Your trusted contacts help you recover access while you share NYC tips with the tourist."
                    }
                ],
                otherOptions: [
                    {
                        text: "Search for seed phrase",
                        outcome: "You leave the tourist confused as you rush home to check your backup..."
                    }
                ]
            }
        ];
    </script>
</body>
</html>